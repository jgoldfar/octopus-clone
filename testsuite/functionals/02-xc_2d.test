# -*- coding: utf-8 mode: shell-script -*-
# $Id$

Test       : XC 2D
Program    : octopus
TestGroups : short-run, functionals
Enabled    : Yes

Input: 02-xc_2d.00-hartree.inp
match ; Hartree energy                           ; GREPFIELD(static/info, 'Total       =', 3) ; 1.11152575; 0.0001
match ; Hartree eigenvalues sum                  ; GREPFIELD(static/info, 'Eigenvalues =', 3) ; 1.42855062; 0.0002
match ; Hartree kinetic energy                   ; GREPFIELD(static/info, 'Kinetic     =', 3) ; 0.31638757; 0.0001
match ; Hartree external energy                  ; GREPFIELD(static/info, 'External    =', 3) ; 0.47811330; 0.0002
match ; Hartree eigenvalue 1 up                  ; GREPFIELD(static/info, '  1   up', 3) ; 0.607023; 0.0001
match ; Hartree eigenvalue 2 up                  ; GREPFIELD(static/info, '  2   up', 3) ; 0.821598; 0.0001
match ; Hartree eigenvalue 1 dn                  ; GREPFIELD(static/info, '  1   dn', 3) ; 1.156287; 0.0001
match ; Hartree eigenvalue 2 dn                  ; GREPFIELD(static/info, '  2   dn', 3) ; 1.221884; 0.0001

# This tests the Hartree-Fock implementation. It reproduces one number
# given in: [B. Reusch et al., Phys. Rev. B 63, 113313]. I have chosen
# a 2D calculation because of the great computational load produced by
# Hartree-Fock calculation.
#
# The input file produces an unrestricted Hartree-Fock calculation for
# a two-electron quantum-dot in an S=1 configuration. The details of
# the calculation correspond to the first row of Table I in the
# aforementioned paper. The units in that table are given in units of
# "omega", and since omega in this case is 0.25 effective atomic
# units, 1.0419 e.a.u. corresponds to 4.168, as given in the table.

# Results for 8-electron quantum dots, provided in the paper, can
# also be approximately reproduced. I do not put a test because it
# would be too slow. In fact, the results provided by octopus are
# lower in energy and closer to the Quantum Monte Carlo numbers, which
# could be due to the use of an underconverged basis set in the paper.

Input: 02-xc_2d.01-hf.inp
match ; Hartree-Fock energy                      ; GREPFIELD(static/info, 'Total       =', 3) ; 1.04191861; 0.0001
match ; Hartree-Fock eigenvalues sum             ; GREPFIELD(static/info, 'Eigenvalues =', 3) ; 1.31401934; 0.0001
match ; Hartree-Fock kinetic energy              ; GREPFIELD(static/info, 'Kinetic     =', 3) ; 0.31688385; 0.0001
match ; Hartree-Fock external energy             ; GREPFIELD(static/info, 'External    =', 3) ; 0.45293349; 0.0001
match ; Hartree-Fock eigenvalue 1 up             ; GREPFIELD(static/info, '  1   up', 3) ; 0.537515; 0.0001
match ; Hartree-Fock eigenvalue 2 up             ; GREPFIELD(static/info, '  2   up', 3) ; 0.776505; 0.0001
match ; Hartree-Fock eigenvalue 1 dn             ; GREPFIELD(static/info, '  1   dn', 3) ; 1.169397; 0.0001
match ; Hartree-Fock eigenvalue 2 dn             ; GREPFIELD(static/info, '  2   dn', 3) ; 1.224726; 0.0001

# We use the wave-functions obtained to test the 2D XC functionals

Input: 02-xc_2d.lda_amgb.inp
match ; LDA AMGB eigenvalue 1 up               ; GREPFIELD(static/info, '  1   up', 3) ; 0.746062; 0.0001
match ; LDA AMGB eigenvalue 2 up               ; GREPFIELD(static/info, '  2   up', 3) ; 0.930742; 0.0001
match ; LDA AMGB eigenvalue 1 dn               ; GREPFIELD(static/info, '  1   dn', 3) ; 0.927729; 0.0001
match ; LDA AMGB eigenvalue 2 dn               ; GREPFIELD(static/info, '  2   dn', 3) ; 1.040174; 0.0001
match ; LDA Exchange                           ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.62342504; 0.0001
match ; LDA AMGB Correlation                   ; GREPFIELD(static/info, 'Correlation =', 3) ; -0.03534534; 0.0001
match ; LDA AMGB Int[n*v_xc]                   ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.97730047; 0.0001

Input: 02-xc_2d.gga_b86.inp
match ; GGA 2D B86 eigenvalue 1 up             ; GREPFIELD(static/info, '  1   up', 3) ; 0.758378; 0.0001
match ; GGA 2D B86 eigenvalue 2 up             ; GREPFIELD(static/info, '  2   up', 3) ; 0.934658; 0.0001
match ; GGA 2D B86 eigenvalue 1 dn             ; GREPFIELD(static/info, '  1   dn', 3) ; 1.169397; 0.0001
match ; GGA 2D B86 eigenvalue 2 dn             ; GREPFIELD(static/info, '  2   dn', 3) ; 1.224726; 0.0001
match ; GGA 2D B86 Exchange                    ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.66569035; 0.0001
match ; GGA 2D B86 Int[n*v_xc]                 ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.96106957; 0.0001

Input: 02-xc_2d.gga_b86_mgc.inp
match ; GGA 2D B86 MGC eigenvalue 1 up         ; GREPFIELD(static/info, '  1   up', 3) ; 0.757507; 0.0001
match ; GGA 2D B86 MGC eigenvalue 2 up         ; GREPFIELD(static/info, '  2   up', 3) ; 0.932683; 0.0001
match ; GGA 2D B86 MGC eigenvalue 1 dn         ; GREPFIELD(static/info, '  1   dn', 3) ; 1.169397; 0.0001
match ; GGA 2D B86 MGC eigenvalue 2 dn         ; GREPFIELD(static/info, '  2   dn', 3) ; 1.224726; 0.0001
match ; GGA 2D B86 MGC Exchange                ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.65901733; 0.0001
match ; GGA 2D B86 MGC Int[n*v_xc]             ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.96391509; 0.0001

Input: 02-xc_2d.gga_b88.inp
match ; GGA 2D B88 eigenvalue 1 up             ; GREPFIELD(static/info, '  1   up', 3) ; 0.751802; 0.0001
match ; GGA 2D B88 eigenvalue 2 up             ; GREPFIELD(static/info, '  2   up', 3) ; 0.922801; 0.0001
match ; GGA 2D B88 eigenvalue 1 dn             ; GREPFIELD(static/info, '  1   dn', 3) ; 1.169397; 0.0001
match ; GGA 2D B88 eigenvalue 2 dn             ; GREPFIELD(static/info, '  2   dn', 3) ; 1.224726; 0.0001
match ; GGA 2D B88 Exchange                    ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.67040364; 0.0001
match ; GGA 2D B88 Int[n*v_xc]                 ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.97950183; 0.0001

Input: 02-xc_2d.gga_pbe.inp
match ; GGA 2D PBE eigenvalue 1 up             ; GREPFIELD(static/info, '  1   up', 3) ; 0.752796; 0.0001
match ; GGA 2D PBE eigenvalue 2 up             ; GREPFIELD(static/info, '  2   up', 3) ; 0.923345; 0.0001
match ; GGA 2D PBE eigenvalue 1 dn             ; GREPFIELD(static/info, '  1   dn', 3) ; 1.169397; 0.0001
match ; GGA 2D PBE eigenvalue 2 dn             ; GREPFIELD(static/info, '  2   dn', 3) ; 1.224726; 0.0001
match ; GGA 2D PBE Exchange                    ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.67022789; 0.0001
match ; GGA 2D PBE Int[n*v_xc]                 ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.97796406; 0.0001

# From PRM 2008 paper: "a spin-polarized extension of the present functional is still missing"
# Though Octopus and libxc do not flag a problem when running spin-polarized,
# we will do SCF from scratch spin-unpolarized. Restarting from spin-polarized Hartree-Fock like the others
# would mean deliberately misunderstanding the restart wavefunctions.
Input: 02-xc_2d.lda_prm.inp
match ; LDA PRM eigenvalue 1                   ; GREPFIELD(static/info, '  1   ', 3)   ; 0.800413; 0.0001
match ; LDA PRM eigenvalue 2                   ; GREPFIELD(static/info, '  2   ', 3)   ; 0.985039; 0.0001
match ; LDA Exchange                           ; GREPFIELD(static/info, 'Exchange    =', 3) ; -0.40774389; 0.0001
match ; LDA PRM Correlation                    ; GREPFIELD(static/info, 'Correlation =', 3) ; -0.11830011; 0.0001
match ; LDA PRM Int[n*v_xc]                    ; GREPFIELD(static/info, 'Int\[n\*v_xc\] =', 3) ; -0.75815185; 0.0001
